(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,function(e,t,a){"use strict";var n=a(2),r=a(3),s=a(11),i=a.n(s),o=function(){function e(t){Object(n.a)(this,e),this.print=i()("drawover:"+t)}return Object(r.a)(e,[{key:"debug",value:function(){this.print.apply(this,["%c debug ","background-color: #aaaaaa; color: #ffffff"].concat(Array.prototype.slice.call(arguments)))}},{key:"info",value:function(){this.print.apply(this,["%c info ","background-color: #66c2cd; color: #ffffff"].concat(Array.prototype.slice.call(arguments)))}},{key:"warning",value:function(){this.print.apply(this,["%c warning ","background-color: #dbaa79; color: #ffffff"].concat(Array.prototype.slice.call(arguments)))}},{key:"error",value:function(){this.print.apply(this,["%c error ","background-color: #e88388; color: #ffffff"].concat(Array.prototype.slice.call(arguments)))}}]),e}();t.a=o},,,,,function(e,t,a){"use strict";(function(e){var n=a(2),r=a(3),s=a(5),i=a(4),o=a(6),c=a(0),h=a.n(c),l=new(a(7).a)("WorkerPool"),u=function(t){function a(t){var r;return Object(n.a)(this,a),(r=Object(s.a)(this,Object(i.a)(a).call(this,t))).state={totalReady:0},r.workers=[],r.waitingToPostInfo=!1,r.metadata={},l.info("hello",e),r}return Object(o.a)(a,t),Object(r.a)(a,[{key:"componentDidMount",value:function(){this.startWebWorkers()}},{key:"componentDidUpdate",value:function(e){e.workers!==this.props.workers&&this.startWebWorkers()}},{key:"startWebWorkers",value:function(){for(;this.workers.length<this.props.workers;)this.addWebWorker()}},{key:"addWebWorker",value:function(){var e=this,t=new Worker(a.WEBWORKER_SCRIPT);t.ready=!1,t.working=!1,t.onmessage=function(a){return e.onWorkerMessage(t,a)},t.onerror=function(a){return e.onWorkerError(t,a)},this.workers.push(t)}},{key:"load",value:function(e){var t=this.workers,a=e.name,n=new FileReader;n.onload=function(){var e=this;t.forEach(function(t){t.postMessage({type:"load",filename:a,data:e.result})})},n.readAsArrayBuffer(e),this.waitingToPostInfo=!0}},{key:"onWorkerMessage",value:function(e,t){var a=t.data;switch(l.info("Web Worker Message",e,a),a.type){case"ready":this.onWorkerReady(e,a);break;case"loaded":this.onWorkerLoaded(e,a);break;case"info":this.onWorkerInfo(e,a);break;case"frames":this.onWorkerFrames(e,a);break;default:l.error("Unknown Web Worker Message",e,a)}}},{key:"onWorkerError",value:function(e){l.error("Web Worker Error",arguments)}},{key:"onWorkerReady",value:function(e){e.ready=!0;var t=0;this.workers.forEach(function(e){e.ready&&t++}),this.setState({totalReady:t})}},{key:"onWorkerLoaded",value:function(e){this.waitingToPostInfo&&(this.waitingToPostInfo=!1,e.postMessage({type:"info"}))}},{key:"onWorkerInfo",value:function(e,t){this.metadata=t.metadata,this.props.onMetadata&&this.props.onMetadata(t.metadata)}},{key:"onWorkerFrames",value:function(e,t){this.props.onFrames&&this.props.onFrames(t.start,t.end,t.frames)}},{key:"getIdleWorkers",value:function(){var e=[];return this.workers.forEach(function(t){!t.working&&t.ready&&e.push(t)}),e}},{key:"isWarmingUp",value:function(){for(var e=0;e<this.workers.length;e++)if(!this.workers[e].ready)return!0;return!1}},{key:"extractFrames",value:function(e,t,a){var n=parseInt(e,10),r=this.getIdleWorkers();if(l.info("Available workers",r),r.length<2)l.warning("Needs two idle workers, and no queue process yet. Quitting");else for(var s=2*t/r.length,i=0;i<r.length;i++){var o=Math.floor(n-t+s*i),c=Math.floor(o+s+1);console.log("Worker",i,"Range",o,"to",c),r[i].postMessage({type:"job",metadata:this.metadata,start:o,end:c})}}},{key:"render",value:function(){return null}}]),a}(h.a.Component);u.WEBWORKER_SCRIPT="ffmpeg-worker.js",u.defaultProps={workers:2},t.a=u}).call(this,a(35)(e))},,,function(e,t,a){e.exports=a(38)},,,,,function(e,t,a){},,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,,function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(10),i=a.n(s),o=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function c(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var h=a(2),l=a(3),u=a(5),d=a(4),p=a(6),m=a(1),f=(a(20),a(7)),v=new f.a("Video"),y=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onVideoLoad=a.onVideoLoad.bind(Object(m.a)(Object(m.a)(a))),a.onVideoSeeked=a.onVideoSeeked.bind(Object(m.a)(Object(m.a)(a))),a.onAnimFrame=a.onAnimFrame.bind(Object(m.a)(Object(m.a)(a))),a.onImageLoad=a.onImageLoad.bind(Object(m.a)(Object(m.a)(a))),a.video=r.a.createRef(),a.canvas=r.a.createRef(),a.backbuffer=r.a.createRef(),a.image=r.a.createRef(),a.context=null,a.backbufferContext=null,a.frames={total:0,start:0,end:0},a.frameCache={},a.cacheFrameReady=!1,a.videoFrameReady=!1,a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.video.current.addEventListener("loadeddata",this.onVideoLoad,!1),this.video.current.addEventListener("seeked",this.onVideoSeeked,!1),this.image.current.addEventListener("load",this.onImageLoad,!1),this.transform(this.props.translate,this.props.scale,this.props.rotate)}},{key:"componentDidUpdate",value:function(e,t){e.translate.x===this.props.translate.x&&e.translate.y===this.props.translate.y&&e.scale===this.props.scale&&e.rotate===this.props.rotate||this.transform(this.props.translate,this.props.scale,this.props.rotate)}},{key:"onVideoLoad",value:function(){var e=this.video.current.duration*this.props.fps;console.log("Video loaded with",e,"frames across",this.video.current.duration,"seconds"),this.frames.total=e,this.frames.end=e,this.videoWidth=this.video.current.videoWidth,this.videoHeight=this.video.current.videoHeight,this.backbuffer.current.width=this.videoWidth*this.props.backbufferScale,this.backbuffer.current.height=this.videoHeight*this.props.backbufferScale,this.previousFrameTime=Date.now(),this.previousFrame=-1,this.frame=0,this.clearCanvas(),this.drawCurrentFrame(),this.props.onReady&&this.props.onReady()}},{key:"onVideoSeeked",value:function(){this.videoFrameReady=!0,this.drawCurrentFrame()}},{key:"onImageLoad",value:function(){this.cacheFrameReady=!0,this.drawCurrentFrame()}},{key:"canLoad",value:function(e){return this.video.current.canPlayType(e.type)}},{key:"load",value:function(e){this.frameCache={},this.video.current.src=e}},{key:"play",value:function(){this.video.current.play(),this.requestId=window.requestAnimationFrame(this.onAnimFrame)}},{key:"pause",value:function(){this.video.current.pause(),window.cancelAnimationFrame(this.requestId)}},{key:"isPlaying",value:function(){return!this.video.current.paused&&!this.video.current.ended}},{key:"onAnimFrame",value:function(){var e=Date.now(),t=e-this.previousFrameTime,a=1e3/this.props.fps;this.requestId=window.requestAnimationFrame(this.onAnimFrame),t>a&&(this.previousFrameTime=e-t%a,this.drawCurrentFrame(),(this.frame<this.startFrame||this.frame>this.endFrame)&&(this.frame=this.startFrame))}},{key:"transform",value:function(e,t,a){var n=this.canvas.current.getContext("2d");n.setTransform(1,0,0,1,0,0),n.translate(e.x,e.y),n.scale(t,t),n.rotate(a),this.clearCanvas(),this.drawCurrentFrame()}},{key:"clearCanvas",value:function(){var e=this.canvas.current.getContext("2d");e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.current.width,this.canvas.current.height),e.restore()}},{key:"drawCurrentFrame",value:function(){var e=this.canvas.current.getContext("2d");this.cacheFrameReady&&!this.videoFrameReady?e.drawImage(this.image.current,0,0,this.videoWidth,this.videoHeight):e.drawImage(this.video.current,0,0,this.videoWidth,this.videoHeight),this.frame!==this.previousFrame&&(this.previousFrame=this.frame,this.props.onFrame&&this.props.onFrame(this.frame),this.videoFrameReady&&this.frameCache[this.frame])}},{key:"skip",value:function(e){this.frame=this.frame+e}},{key:"cacheFrames",value:function(e,t,a){for(var n=Math.min(a.length,t-e),r=0;r<n;r++)this.frameCache[e+r]=a[r];v.debug("frameCache",Object.keys(this.frameCache))}},{key:"isFrameCached",value:function(e){return void 0!==this.frameCache[e]}},{key:"clampFrame",value:function(e){return Math.max(this.startFrame,Math.min(e,this.endFrame))}},{key:"render",value:function(){var e="none";return this.props.showSources&&(e="block"),r.a.createElement("div",{className:"video"},r.a.createElement("canvas",{ref:this.canvas,width:this.props.width,height:this.props.height}),r.a.createElement("canvas",{ref:this.backbuffer,style:{display:"none"}}),r.a.createElement("div",{className:"video-sources",style:{display:e}},r.a.createElement("div",{className:"video-source"},r.a.createElement("div",{className:"video-source-label"},"Original Video"),r.a.createElement("video",{className:"video-source-render",ref:this.video,muted:!0,loop:!0})),r.a.createElement("div",{className:"video-source"},r.a.createElement("div",{className:"video-source-label"},"Frame Cache"),r.a.createElement("img",{alt:"frame",className:"video-source-render",ref:this.image}))))}},{key:"startFrame",get:function(){return this.frames.start},set:function(e){this.frames.start=Math.max(0,Math.min(e,this.endFrame-1))}},{key:"endFrame",get:function(){return this.frames.end},set:function(e){this.frames.end=Math.max(this.startFrame+1,Math.min(e,this.totalFrames))}},{key:"totalFrames",get:function(){return this.frames.total}},{key:"frame",get:function(){return this.video.current?Math.round(this.video.current.currentTime*this.props.fps):0},set:function(e){var t=this.clampFrame(e);this.video.current.currentTime=t/this.props.fps,this.videoFrameReady=!1,this.cacheFrameReady=this.isFrameCached(t),this.cacheFrameReady&&(this.image.current.src=this.frameCache[t])}},{key:"speed",get:function(){return this.video.current.playbackRate},set:function(e){this.video.current.playbackRate=e}}]),t}(r.a.Component);y.defaultProps={fps:29.98,width:720,height:480,translate:{x:0,y:0},scale:1,rotate:0,backbufferScale:.8,showSources:!1};var k=y,b=a(8),g=a(13),w=function(){function e(t){Object(h.a)(this,e),this.fps=t}return Object(l.a)(e,[{key:"to",value:function(e){var t=e/this.fps,a=t/60,n=a/60,r=Math.floor(e%this.fps);return r<10&&(r="0"+r),(t=Math.floor(t%60))<10&&(t="0"+t),(a=Math.floor(a%60))<10&&(a="0"+a),(n=Math.floor(n%24))<10&&(n="0"+n),"".concat(n,":").concat(a,":").concat(t,":").concat(r)}},{key:"from",value:function(e){var t,a,n,r,s=e.split(":"),i=Object(g.a)(s,4);return t=i[0],a=i[1],n=i[2],r=i[3],60*parseInt(t,10)+60*parseInt(a,10)+parseInt(n,10)*this.fps+parseInt(r,10)}}]),e}(),C=(a(25),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={start:e.min,end:e.max},a.ref=r.a.createRef(),a.onUpdateSlider=a.onUpdateSlider.bind(Object(m.a)(Object(m.a)(a))),a.onChangeStartFrame=a.onChangeStartFrame.bind(Object(m.a)(Object(m.a)(a))),a.onChangeEndFrame=a.onChangeEndFrame.bind(Object(m.a)(Object(m.a)(a))),a.onChange=a.onChange.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.noUiSlider.create(this.ref.current,{connect:!0,behaviour:"drag",tooltips:[this.getTooltipFormatter(),this.getTooltipFormatter()],animate:!1,range:{min:this.props.min*this.props.scale,max:this.props.max*this.props.scale},start:[this.state.start*this.props.scale,this.state.end*this.props.scale],margin:10,step:this.props.scale}),this.slider=this.ref.current.noUiSlider,this.connector=this.slider.target.getElementsByClassName("noUi-connect")[0],this.lowerHandle=this.slider.target.getElementsByClassName("noUi-handle-lower")[0],this.upperHandle=this.slider.target.getElementsByClassName("noUi-handle-upper")[0],this.slider.on("update",this.onUpdateSlider),[].forEach.call(this.slider.target.getElementsByClassName("noUi-tooltip"),function(e){e.addEventListener("mousemove",t.noop,!0),e.addEventListener("mousedown",t.noop,!0)})}},{key:"getTooltipFormatter",value:function(){return new w(this.props.fps)}},{key:"componentDidUpdate",value:function(e){e.min===this.props.min&&e.max===this.props.max||(this.slider.updateOptions({range:{min:this.props.min*this.props.scale,max:this.props.max*this.props.scale},start:[this.props.min*this.props.scale,this.props.max*this.props.scale]},!1),this.setState({start:this.props.min,end:this.props.max}))}},{key:"updateHandleLabels",value:function(){var e=this.connector.getBoundingClientRect().width;return e>188?(this.lowerHandle.classList.remove("is-outside"),void this.upperHandle.classList.remove("is-outside")):e>118?(this.lowerHandle.classList.add("is-outside"),void this.upperHandle.classList.remove("is-outside")):(this.lowerHandle.classList.add("is-outside"),void this.upperHandle.classList.add("is-outside"))}},{key:"onUpdateSlider",value:function(e){var t=Math.round(e[0]/this.props.scale),a=Math.round(e[1]/this.props.scale);this.setState({start:t,end:a}),this.updateHandleLabels(),this.props.onChange&&this.props.onChange(t,a)}},{key:"onChange",value:function(e){this.setState(Object(b.a)({},e.target.name,e.target.value))}},{key:"onChangeStartFrame",value:function(e){this.slider.set([e.target.value*this.props.scale,null])}},{key:"onChangeEndFrame",value:function(e){this.slider.set([null,e.target.value*this.props.scale])}},{key:"render",value:function(){return r.a.createElement("div",{className:"range-slider"},r.a.createElement("input",{type:"number",name:"min",value:Math.round(this.props.min),readOnly:!0}),r.a.createElement("input",{type:"number",name:"start",value:Math.round(this.state.start),onChange:this.onChange,onBlur:this.onChangeStartFrame}),r.a.createElement("div",{ref:this.ref}),r.a.createElement("input",{type:"number",name:"end",value:Math.round(this.state.end),onChange:this.onChange,onBlur:this.onChangeEndFrame}),r.a.createElement("input",{type:"number",name:"max",value:Math.round(this.props.max),readOnly:!0}))}}],[{key:"noop",value:function(e){return e.stopPropagation(),!1}}]),t}(r.a.Component));C.defaultProps={min:0,max:100,scale:1};var O=C,E=(a(27),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={start:0,end:1,current:0,currentInput:0,keys:{}},a.ref=r.a.createRef(),a.onSliderChange=a.onSliderChange.bind(Object(m.a)(Object(m.a)(a))),a.onInputChange=a.onInputChange.bind(Object(m.a)(Object(m.a)(a))),a.onInputBlur=a.onInputBlur.bind(Object(m.a)(Object(m.a)(a))),a.onClick=a.onClick.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"setRange",value:function(e,t){this.setState({start:parseInt(e,10),end:parseInt(t,10)})}},{key:"setFrame",value:function(e){this.setState({current:e,currentInput:e})}},{key:"componentDidMount",value:function(){window.noUiSlider.create(this.ref.current,{start:this.state.current,step:1,tooltips:this.getTooltipFormatter(),behaviour:"snap",animate:!1,range:{min:this.state.start,max:this.state.end},pips:this.getPips()}),this.slider=this.ref.current.noUiSlider,this.handle=this.slider.target.getElementsByClassName("noUi-handle")[0],this.slider.on("change",this.onSliderChange),this.slider.on("slide",this.onSliderChange),this.setState({current:parseInt(this.slider.get(),10),currentInput:parseInt(this.slider.get(),10)})}},{key:"componentDidUpdate",value:function(e,t){t.current!==this.state.current&&(this.slider.set(this.state.current),this.updateHandleVisibility()),t.start===this.state.start&&t.end===this.state.end||(this.slider.updateOptions({range:{min:this.state.start,max:this.state.end}}),this.slider.pips(this.getPips(this.state.start,this.state.end)),this.updateHandleVisibility(),this.updateHandleWidth())}},{key:"updateHandleVisibility",value:function(){if(this.slider.target){var e=this.slider.target.getElementsByClassName("noUi-origin");this.state.current>=this.state.start&&this.state.current<=this.state.end?(e[0].classList.remove("is-off-timeline"),this.slider.set(this.state.current)):e[0].classList.add("is-off-timeline")}}},{key:"updateHandleWidth",value:function(){var e=this.state,t=e.start,a=100/(e.end-t)+"%";this.handle.style.width=a}},{key:"getTooltipFormatter",value:function(){return new w(this.props.fps)}},{key:"getPips",value:function(e,t){if(!e&&!t)return null;for(var a=t-e,n=1,r=0;;){if(a<50*n){r=n;break}if(a<100*n){r=2*n;break}if(a<200*n){r=5*n;break}n*=10}for(var s=[],i=e;i<=t;i+=r)s.push(i);return{mode:"values",values:s,density:-1}}},{key:"onSliderChange",value:function(e){var t=parseInt(e[0],10);this.state.current!==t&&(this.setState({current:t,currentInput:t}),this.props.onChange&&this.props.onChange(t))}},{key:"onInputChange",value:function(e){this.setState(Object(b.a)({},e.target.name,e.target.value))}},{key:"onInputBlur",value:function(e){this.slider.set(e.target.value),this.props.onChange&&this.props.onChange(parseInt(this.slider.get(),10))}},{key:"setKey",value:function(e,t){var a=this.state.keys;a[e]=t,this.setState({keys:a})}},{key:"hasKey",value:function(e){return e in this.state.keys}},{key:"deleteKey",value:function(e){var t=this.state.keys;delete t[e],this.setState({keys:t})}},{key:"deleteAllKeys",value:function(){this.setState({keys:{}})}},{key:"renderKeys",value:function(){var e=this,t=this.state,a=t.start,n=t.end;return r.a.createElement("div",{className:"time-slider-keys"},Object.keys(this.state.keys).map(function(t){var s=e.state.keys[t];return t>=a&&t<=n?r.a.createElement("div",{key:t,className:"time-slider-key",style:{left:(t-a)/(n-a)*100+"%",width:100/(n-a)+"%"},"data-type":s,"data-frame":t}):null}))}},{key:"onClick",value:function(e){if(e.target.dataset.frame){var t=e.target.dataset.frame;this.state.current!==t&&(this.setState({current:t,currentInput:t}),this.props.onChange&&this.props.onChange(t))}}},{key:"render",value:function(){return r.a.createElement("div",{className:"time-slider",onClick:this.onClick},r.a.createElement("div",{className:"time-slider-noui"},r.a.createElement("div",{ref:this.ref}),this.renderKeys(this.props.keys)),r.a.createElement("input",{type:"number",name:"currentInput",value:this.state.currentInput,onChange:this.onInputChange,onBlur:this.onInputBlur}))}}]),t}(r.a.Component));E.defaultProps={keys:[]};var j=E,x=(a(29),new f.a("Draw")),S=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).penColors=["#FF0000","#00FF00","#0000FF","#000000","#FFFFFF"],a.state={tool:null,color:null,lineWidth:5,previousTool:"pen",history:[],historyIndex:0,empty:!0},a.points=[],a.dragging=!1,a.mouseX=0,a.mouseY=0,a.matrix=new window.DOMMatrixReadOnly,a.canvas=r.a.createRef(),a.temp=r.a.createRef(),a.onMouseMove=a.onMouseMove.bind(Object(m.a)(Object(m.a)(a))),a.onMouseUp=a.onMouseUp.bind(Object(m.a)(Object(m.a)(a))),a.onMouseDown=a.onMouseDown.bind(Object(m.a)(Object(m.a)(a))),a.onTouchStart=a.onTouchStart.bind(Object(m.a)(Object(m.a)(a))),a.onTouchEnd=a.onTouchEnd.bind(Object(m.a)(Object(m.a)(a))),a.onTouchMove=a.onTouchMove.bind(Object(m.a)(Object(m.a)(a))),a.onTouchCancel=a.onTouchCancel.bind(Object(m.a)(Object(m.a)(a))),a.onKeyDown=a.onKeyDown.bind(Object(m.a)(Object(m.a)(a))),a.onChangeLineWidth=a.onChangeLineWidth.bind(Object(m.a)(Object(m.a)(a))),a.onClear=a.onClear.bind(Object(m.a)(Object(m.a)(a))),a.onContextMenu=a.onContextMenu.bind(Object(m.a)(Object(m.a)(a))),a.undo=a.undo.bind(Object(m.a)(Object(m.a)(a))),a.redo=a.redo.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.transform(this.props.translate,this.props.scale,this.props.rotate),this.props.readonly||(this.setPen(this.penColors[0]),this.temp.current.addEventListener("contextmenu",this.onContextMenu)),this.props.source&&this.deserialize(this.props.source)}},{key:"componentDidUpdate",value:function(e,t){t.tool===this.state.tool&&t.lineWidth===this.state.lineWidth||this.redrawCursorSVG(),e.translate.x===this.props.translate.x&&e.translate.y===this.props.translate.y&&e.scale===this.props.scale&&e.rotate===this.props.rotate||this.transform(this.props.translate,this.props.scale,this.props.rotate),t.historyIndex!==this.state.historyIndex&&this.setState({empty:this.isEmpty()})}},{key:"clearTemp",value:function(){var e=this.tempContext;e&&(e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.temp.current.width,this.temp.current.height),e.restore())}},{key:"endCurrentLine",value:function(){if(this.points.length){var e=this.canvasContext;this.pushHistory(this.state.tool,this.state.color,this.state.lineWidth,this.points),e.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(this.temp.current,0,0),e.restore(),this.clearTemp(),this.points=[],this.props.onDraw&&this.props.onDraw()}}},{key:"onMouseDown",value:function(e){this.state.toolsVisible?this.setState({toolsVisible:!1}):(1===e.buttons&&(this.dragging=!0),this.dragging&&(this.trackMouse(e),this.draw()))}},{key:"onMouseUp",value:function(e){this.dragging&&(this.dragging=!1,this.endCurrentLine())}},{key:"onMouseMove",value:function(e){this.state.toolsVisible||(1===e.buttons&&(this.dragging=!0),this.trackMouse(e),this.dragging&&this.draw())}},{key:"onTouchStart",value:function(e){x.debug("Touch Start",e);var t=e.changedTouches;this.touchIdentifier||(this.touchIdentifier=t[0].identifier,this.dragging=!0,this.trackTouch(t[0]),this.draw())}},{key:"onTouchEnd",value:function(e){x.debug("Touch End",e);for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===this.touchIdentifier&&(this.touchIdentifier=null,this.dragging=!1,this.endCurrentLine())}},{key:"onTouchCancel",value:function(e){x.debug("Touch Cancel",e),this.onTouchEnd(e)}},{key:"onTouchMove",value:function(e){for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===this.touchIdentifier&&(this.trackTouch(t[a]),this.draw())}},{key:"onKeyDown",value:function(e){90===e.keyCode&&e.ctrlKey?this.undo():89===e.keyCode&&e.ctrlKey?this.redo():27===e.keyCode&&this.setState({toolsVisible:!1})}},{key:"onContextMenu",value:function(e){return e.preventDefault(),this.setState({toolsVisible:!0,toolsOrigin:{top:e.pageY,left:e.pageX}}),!1}},{key:"trackMouse",value:function(e){var t=this.transformedPoint(e.nativeEvent.offsetX,e.nativeEvent.offsetY);this.mouseX=t.x,this.mouseY=t.y}},{key:"trackTouch",value:function(e){var t=this.transformedPoint(e.pageX-e.target.offsetLeft,e.pageY-e.target.offsetTop);this.mouseX=t.x,this.mouseY=t.y}},{key:"clear",value:function(){var e=this.canvasContext;e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.current.width,this.canvas.current.height),e.restore(),this.clearTemp()}},{key:"redraw",value:function(e){var a=this.canvasContext;this.clear();for(var n=0;n<e;n++){var r=this.state.history[n];r.tool===t.ERASE_TOOL?this.pen(a,"",r.lineWidth,r.points,"destination-out"):r.tool===t.PEN_TOOL?this.pen(a,r.color,r.lineWidth,r.points,"source-over"):r.tool===t.CLEAR_TOOL&&this.clear()}}},{key:"pen",value:function(e,t,a,n,r){var s,i,o,c,h=1;if(e.lineWidth=a,e.lineJoin="round",e.lineCap="round",e.strokeStyle=t,e.fillStyle=t,e.globalCompositeOperation=r,n.length<3)return e.beginPath(),e.arc(n[0].x,n[0].y,a/2,0,2*Math.PI),e.fill(),void e.closePath();for(e.beginPath(),e.moveTo(n[0].x,n[0].y);h<n.length-2;h++)s=n[h].x,i=n[h].y,o=(s+n[h+1].x)/2,c=(i+n[h+1].y)/2,e.quadraticCurveTo(s,i,o,c);s=n[h].x,i=n[h].y,o=n[h+1].x,c=n[h+1].y,e.quadraticCurveTo(s,i,o,c),e.stroke()}},{key:"draw",value:function(){this.points.push({x:this.mouseX,y:this.mouseY}),this.state.tool===t.ERASE_TOOL?this.pen(this.canvasContext,"",this.state.lineWidth,this.points,"destination-out"):(this.clearTemp(),this.pen(this.tempContext,this.state.color,this.state.lineWidth,this.points,"source-over"))}},{key:"setPen",value:function(e){this.setState({tool:t.PEN_TOOL,color:e,toolsVisible:!1})}},{key:"setEraser",value:function(){this.setState({tool:t.ERASE_TOOL,color:"",toolsVisible:!1})}},{key:"onChangeLineWidth",value:function(e){var t=this.canvas.current.getContext("2d"),a=this.temp.current.getContext("2d");t.lineWidth=e.target.value,a.lineWidth=e.target.value,this.setState({lineWidth:e.target.value})}},{key:"pushHistory",value:function(e,t,a,n){var r=this.state.history,s=this.state.historyIndex;s<r.length&&r.splice(s),r.push({tool:e,color:t,lineWidth:a,points:n}),s++,this.setState({history:r,historyIndex:s})}},{key:"undo",value:function(){var e=this.state.historyIndex-1;e<0&&(e=0),this.setState({historyIndex:e}),this.redraw(e),e<1||this.state.history[e].tool===t.ERASE_TOOL?this.props.onClear&&this.props.onClear():this.props.onDraw&&this.props.onDraw()}},{key:"redo",value:function(){var e=this.state.historyIndex+1;e>this.state.history.length&&(e=this.state.history.length),this.setState({historyIndex:e}),this.redraw(e),this.state.history[e].tool===t.ERASE_TOOL?this.props.onClear&&this.props.onClear():this.props.onDraw&&this.props.onDraw()}},{key:"reset",value:function(){this.clear(),this.setState({history:[],historyIndex:0})}},{key:"isEmpty",value:function(){if(this.state.historyIndex<1)return!0;var e=this.state.history[this.state.historyIndex-1].tool;return e===t.CLEAR_TOOL||e!==t.PEN_TOOL}},{key:"serialize",value:function(){for(var e=[],a=0;a<this.state.historyIndex;a++){var n=this.state.history[a];if(n.tool===t.CLEAR_TOOL)e=[];else{e.push(n.tool),e.push(parseInt(n.color.substr(1,2),16)),e.push(parseInt(n.color.substr(3,2),16)),e.push(parseInt(n.color.substr(5,2),16)),e.push(n.lineWidth),e.push(2*n.points.length);for(var r=0;r<n.points.length;r++)e.push(n.points[r].x),e.push(n.points[r].y)}}return new Int16Array(e).buffer}},{key:"deserialize",value:function(e){for(var t=this,a=new Int16Array(e),n=[],r=0;r<a.length;){var s={tool:a[r],color:"#"+a[r+1].toString(16).padStart(2,"0")+a[r+2].toString(16).padStart(2,"0")+a[r+3].toString(16).padStart(2,"0"),lineWidth:a[r+4]},i=a[r+=5],o=[];r++;for(var c=0;c<i;c+=2)o.push({x:a[r+c],y:a[r+c+1]});s.points=o,r+=i,n.push(s)}this.setState({history:n,historyIndex:n.length},function(){return t.redraw(n.length)})}},{key:"onClear",value:function(){this.clear(),this.pushHistory(t.CLEAR_TOOL,"","",[]),this.setState({toolsVisible:!1}),this.props.onClear&&this.props.onClear()}},{key:"redrawCursorSVG",value:function(){var e=parseInt(this.state.lineWidth*this.props.scale,10),t=e/2,a='\n            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"\n                xmlns:xlink="http://www.w3.org/1999/xlink"\n                x="0" y="0" width="'.concat(e+4,'px" height="').concat(e+4,'px"\n                xml:space="preserve"\n            >\n                <defs>\n                    <filter id="blur" x="0" y="0" filterUnits="userSpaceOnUse">\n                        <feGaussianBlur stdDeviation="1" />\n                    </filter>\n                </defs>\n                <circle cx="').concat(t+2,'" cy="').concat(t+2,'" r="').concat(t-1,'"\n                    stroke="white"\n                    fill="transparent"\n                    stroke-width="0.8"\n                    filter="url(#blur)"\n                />\n                <circle cx="').concat(t+2,'" cy="').concat(t+2,'" r="').concat(t-1,'"\n                    stroke="black"\n                    fill="transparent"\n                    stroke-width="1"\n                />\n            </svg>\n        ');this.setState({cursor:'url("data:image/svg+xml,'.concat(encodeURI(a),'") ').concat(t+2," ").concat(t+2,", crosshair")})}},{key:"transform",value:function(e,t,a){var n=this.canvasContext,r=this.tempContext;this.matrix=new window.DOMMatrixReadOnly,this.matrix=this.matrix.translate(e.x,e.y),this.matrix=this.matrix.scale(t,t),this.matrix=this.matrix.rotate(180*a/Math.PI),n.setTransform(1,0,0,1,0,0),n.translate(e.x,e.y),n.scale(t,t),n.rotate(a),r&&(r.setTransform(1,0,0,1,0,0),r.translate(e.x,e.y),r.scale(t,t),r.rotate(a)),this.redraw(this.state.historyIndex),this.redrawCursorSVG()}},{key:"transformedPoint",value:function(e,t){var a=this.matrix.inverse();return new window.DOMPoint(e*a.a+t*a.c+a.e,e*a.b+t*a.d+a.f,0,1)}},{key:"renderHistory",value:function(){var e=this.state,t=e.history,a=e.historyIndex;return r.a.createElement("ul",{className:"draw-history"},t.map(function(e,t){return r.a.createElement("li",{key:t,className:t>=a?"is-undone":""},t,":",t===a&&r.a.createElement("span",null,"*"),e.tool," - ",e.color," -",e.lineWidth," - ",e.points.length)}))}},{key:"renderTools",value:function(){var e=this,a=this.state,n=a.tool,s=a.color,i=a.lineWidth;return r.a.createElement("div",{className:"draw-tools",style:this.state.toolsOrigin},r.a.createElement("input",{type:"range",min:"1",max:"100",className:"draw-line-width",value:i,onChange:this.onChangeLineWidth}),r.a.createElement("ul",null,this.penColors.map(function(a){return r.a.createElement("li",{key:a},r.a.createElement("button",{className:"draw-pen "+(s===a&&n===t.PEN_TOOL?"is-active":""),onClick:function(){return e.setPen(a)},style:{backgroundColor:a}}))})),r.a.createElement("button",{className:"draw-eraser "+(n===t.PEN_TOOL?"is-active":""),onClick:function(){return e.setEraser()}},"Eraser"),r.a.createElement("button",{className:"draw-clear",onClick:this.onClear},"Clear"),r.a.createElement("button",{className:"draw-undo",onClick:this.undo},"Undo"),r.a.createElement("button",{className:"draw-redo",onClick:this.redo},"Redo"))}},{key:"render",value:function(){return r.a.createElement("div",{className:"draw",style:{opacity:this.props.opacity}},!this.props.readonly&&r.a.createElement("canvas",{ref:this.temp,className:"draw-temp",tabIndex:"0",width:this.props.width,height:this.props.height,onMouseMove:this.onMouseMove,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseUp,onTouchStart:this.onTouchStart,onTouchEnd:this.onTouchEnd,onTouchMove:this.onTouchMove,onTouchCancel:this.onTouchCancel,onKeyDown:this.onKeyDown,style:{cursor:this.state.cursor}}),r.a.createElement("canvas",{ref:this.canvas,className:"draw-canvas",width:this.props.width,height:this.props.height}),this.state.toolsVisible&&this.renderTools())}},{key:"canvasContext",get:function(){return this.canvas.current.getContext("2d")}},{key:"tempContext",get:function(){return this.temp.current?this.temp.current.getContext("2d"):null}}]),t}(r.a.Component);S.PEN_TOOL=1,S.ERASE_TOOL=2,S.CLEAR_TOOL=3,S.defaultProps={readonly:!1,source:null,opacity:1,width:720,height:480,translate:{x:0,y:0},scale:1,rotate:0,onDraw:null,onClear:null};var F=S,M=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={translate:{x:0,y:0},scale:1,rotate:0,active:!1},a.onMouseDownCapture=a.onMouseDownCapture.bind(Object(m.a)(Object(m.a)(a))),a.onMouseMoveCapture=a.onMouseMoveCapture.bind(Object(m.a)(Object(m.a)(a))),a.onWheelCapture=a.onWheelCapture.bind(Object(m.a)(Object(m.a)(a))),a.onKeyDownCapture=a.onKeyDownCapture.bind(Object(m.a)(Object(m.a)(a))),a.onKeyUpCapture=a.onKeyUpCapture.bind(Object(m.a)(Object(m.a)(a))),a.matrix=new window.DOMMatrixReadOnly,a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"onKeyDownCapture",value:function(e){16===e.keyCode&&(this.setState({active:!0}),e.stopPropagation())}},{key:"onKeyUpCapture",value:function(e){16===e.keyCode&&(this.setState({active:!1}),e.stopPropagation())}},{key:"onMouseDownCapture",value:function(e){this.state.active&&e.stopPropagation()}},{key:"onMouseMoveCapture",value:function(e){if(this.state.active&&1===e.buttons){var t=1/this.state.scale,a=e.nativeEvent.movementX*t,n=e.nativeEvent.movementY*t;return this.translate(a,n),void e.stopPropagation()}}},{key:"onWheelCapture",value:function(e){if(this.state.active&&(0!==e.deltaY||0!==e.deltaX)){var t=Math.sign(0!==e.deltaY?e.deltaY:e.deltaX),a=Math.pow(1.1,t),n=this.localSpace(e.nativeEvent.offsetX,e.nativeEvent.offsetY);this.zoom(a,n.x,n.y),e.stopPropagation()}}},{key:"translate",value:function(e,t){this.matrix=this.matrix.translate(e,t),this.setState({translate:{x:this.matrix.e,y:this.matrix.f}})}},{key:"zoom",value:function(e,t,a){this.matrix=this.matrix.translate(t,a),this.matrix=this.matrix.scale(e,e),this.matrix=this.matrix.translate(-t,-a),this.setState({translate:{x:this.matrix.e,y:this.matrix.f},scale:this.state.scale*e})}},{key:"rotate",value:function(e,t,a){throw new Error("Not supported")}},{key:"reset",value:function(){this.matrix=new window.DOMMatrixReadOnly,this.setState({translate:{x:0,y:0},scale:1,rotate:0})}},{key:"localSpace",value:function(e,t){var a=this.matrix.inverse();return new window.DOMPoint(e*a.a+t*a.c+a.e,e*a.b+t*a.d+a.f,0,1)}},{key:"render",value:function(){var e=this.state,t=e.translate,a=e.scale,n=e.rotate,s=r.a.Children.map(this.props.children,function(e){return r.a.cloneElement(e,{translate:t,scale:a,rotate:n})});return r.a.createElement("div",{className:"transform",onMouseDownCapture:this.onMouseDownCapture,onMouseMoveCapture:this.onMouseMoveCapture,onWheelCapture:this.onWheelCapture,onKeyDownCapture:this.onKeyDownCapture,onKeyUpCapture:this.onKeyUpCapture},s)}}]),t}(r.a.Component),W=(a(31),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={active:!1},a.onDragEnter=a.onDragEnter.bind(Object(m.a)(Object(m.a)(a))),a.onDragLeave=a.onDragLeave.bind(Object(m.a)(Object(m.a)(a))),a.onDrop=a.onDrop.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"onDragEnter",value:function(e){this.setState({active:!0}),e.preventDefault()}},{key:"onDragLeave",value:function(e){this.setState({active:!1}),e.preventDefault()}},{key:"onDrop",value:function(e){var t;e.preventDefault(),e.dataTransfer.items?"file"===e.dataTransfer.items[0].kind&&(t=e.dataTransfer.items[0].getAsFile()):e.dataTransfer.files.length&&(t=e.dataTransfer.files[0]),this.setState({active:!1}),t&&this.props.onFile&&this.props.onFile(t)}},{key:"render",value:function(){var e=this.state.active;return r.a.createElement("div",{className:"dropzone "+(e?"is-active":""),onDragOver:this.onDragEnter,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},this.props.children,r.a.createElement("div",{className:"dropzone-overlay"},"Drop files here, and other tales of help"))}}]),t}(r.a.Component));W.defaultProps={onFile:null};var D=W,P=a(14),T=function(e){var t=e.name,a=Object(P.a)(e,["name"]);return r.a.createElement("i",Object.assign({className:"fas fa-"+t},a))};T.defaultProps={name:"thumbs-down"};var I=T,R=(a(33),function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onClickPlay=a.onClickPlay.bind(Object(m.a)(Object(m.a)(a))),a.onClickPause=a.onClickPause.bind(Object(m.a)(Object(m.a)(a))),a.onSelectSpeed=a.onSelectSpeed.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"onClickPlay",value:function(){this.props.onPlay&&this.props.onPlay()}},{key:"onClickPause",value:function(){this.props.onPause&&this.props.onPause()}},{key:"onSelectSpeed",value:function(e){this.props.onSpeed&&this.props.onSpeed(parseFloat(e.target.value,10))}},{key:"skip",value:function(e){this.props.onSkip&&this.props.onSkip(e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"playback"},r.a.createElement("div",{className:"playback-speed"},r.a.createElement("select",{value:this.props.speed,onChange:this.onSelectSpeed},r.a.createElement("option",{value:"0.25"},"0.25x"),r.a.createElement("option",{value:"0.5"},"0.5x"),r.a.createElement("option",{value:"1"},"1x"),r.a.createElement("option",{value:"2"},"2x")),r.a.createElement(I,{name:"angle-down"})),r.a.createElement("button",{onClick:function(){return e.skip(-Number.MAX_SAFE_INTEGER)}},r.a.createElement(I,{name:"fast-backward"})),r.a.createElement("button",{onClick:function(){return e.skip(-1)}},r.a.createElement(I,{name:"step-backward"})),r.a.createElement("button",{className:"playback-prev-key"},r.a.createElement(I,{name:"step-backward"})),!this.props.playing&&r.a.createElement("button",{onClick:this.onClickPlay},r.a.createElement(I,{name:"play"})),this.props.playing&&r.a.createElement("button",{onClick:this.onClickPause},r.a.createElement(I,{name:"pause"})),r.a.createElement("button",{className:"playback-next-key"},r.a.createElement(I,{name:"step-forward"})),r.a.createElement("button",{onClick:function(){return e.skip(1)}},r.a.createElement(I,{name:"step-forward"})),r.a.createElement("button",{onClick:function(){return e.skip(Number.MAX_SAFE_INTEGER)}},r.a.createElement(I,{name:"fast-forward"})))}}]),t}(r.a.Component));R.defaultProps={playing:!1,speed:1,onPause:null,onPlay:null,onSkip:null,onSpeed:null};var L=R,N=a(12),U=(a(36),new f.a("App")),A=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={isNewSession:!0,fps:29.98,playing:!1,loading:!1,speed:1,min:0,max:1,start:0,end:1,keys:[],videoFilename:null,videoSourceUrl:null,totalWebWorkers:0,canvas:{width:800,height:600}},a.drawCache={},a.video=r.a.createRef(),a.workers=r.a.createRef(),a.time=r.a.createRef(),a.range=r.a.createRef(),a.draw=r.a.createRef(),a.canvas=r.a.createRef(),a.onVideoReady=a.onVideoReady.bind(Object(m.a)(Object(m.a)(a))),a.onFrame=a.onFrame.bind(Object(m.a)(Object(m.a)(a))),a.onPickRange=a.onPickRange.bind(Object(m.a)(Object(m.a)(a))),a.onPickFrame=a.onPickFrame.bind(Object(m.a)(Object(m.a)(a))),a.onDropFile=a.onDropFile.bind(Object(m.a)(Object(m.a)(a))),a.onPlaybackSpeed=a.onPlaybackSpeed.bind(Object(m.a)(Object(m.a)(a))),a.onPlaybackPlay=a.onPlaybackPlay.bind(Object(m.a)(Object(m.a)(a))),a.onPlaybackPause=a.onPlaybackPause.bind(Object(m.a)(Object(m.a)(a))),a.onPlaybackSkip=a.onPlaybackSkip.bind(Object(m.a)(Object(m.a)(a))),a.onDrawDraw=a.onDrawDraw.bind(Object(m.a)(Object(m.a)(a))),a.onDrawClear=a.onDrawClear.bind(Object(m.a)(Object(m.a)(a))),a.onWorkerMetadata=a.onWorkerMetadata.bind(Object(m.a)(Object(m.a)(a))),a.onWorkerFrames=a.onWorkerFrames.bind(Object(m.a)(Object(m.a)(a))),a.onAddWebWorker=a.onAddWebWorker.bind(Object(m.a)(Object(m.a)(a))),a.onFrameCache=a.onFrameCache.bind(Object(m.a)(Object(m.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.updateCanvasDimensions()}},{key:"updateCanvasDimensions",value:function(){this.setState({canvas:{width:this.canvas.current.clientWidth,height:this.canvas.current.clientHeight}})}},{key:"onVideoReady",value:function(){this.setState({min:0,max:this.video.current.totalFrames,start:0,end:this.video.current.totalFrames})}},{key:"onWorkerFrames",value:function(e,t,a){U.info("onWorkerFrames",e,t),this.video.current.cacheFrames(e,t,a);for(var n=Math.min(a.length,t-e),r=0;r<n;r++)this.time.current.hasKey(e+r)||this.time.current.setKey(e+r,"cached-frame")}},{key:"onWorkerMetadata",value:function(e){U.info(e),this.setState({fps:e.fps,loading:!1})}},{key:"onFrame",value:function(e){this.video.current&&this.frame!==e&&(this.changeDrawover(this.frame,e),this.time.current.setFrame(e),this.frame=e)}},{key:"onFrameCache",value:function(e){this.time.current.setKey(e,"cached-frame")}},{key:"onPickRange",value:function(e,t){this.time.current.setRange(e,t),this.video.current.startFrame=e,this.video.current.endFrame=t}},{key:"onPickFrame",value:function(e){this.video.current.pause(),this.video.current.frame=e,e!==this.frame&&(this.changeDrawover(this.frame,e),this.frame=e)}},{key:"onPlaybackSpeed",value:function(e){this.setState({speed:e}),this.video.current.speed=e}},{key:"onPlaybackPlay",value:function(){this.video.current.play(),this.setState({playing:!0})}},{key:"onPlaybackPause",value:function(){this.video.current.pause(),this.setState({playing:!1})}},{key:"onPlaybackSkip",value:function(e){this.video.current.skip(e)}},{key:"onDropFile",value:function(e){U.info(e),this.video.current.canLoad(e)?this.changeVideoSource(e):alert("Cannot load type: "+e.type)}},{key:"onDrawDraw",value:function(){var e=this.video.current.frame;U.info("Draw Update",e),this.drawCache[e]=null,this.time.current.setKey(e,"draw-frame"),this.workers.current.extractFrames(e,5*this.state.fps)}},{key:"onDrawClear",value:function(){var e=this.video.current,t=this.time.current,a=e.frame;U.info("Draw Clear",a),delete this.drawCache[a],e.isFrameCached(a)?t.setKey(a,"cached-frame"):t.deleteKey(a)}},{key:"onAddWebWorker",value:function(){this.setState({totalWebWorkers:this.state.totalWebWorkers+1})}},{key:"changeDrawover",value:function(e,t){var a=this.draw.current,n=this.time.current,r=this.video.current;a.isEmpty()?(delete this.drawCache[e],r.isFrameCached(e)?n.setKey(e,"cached-frame"):n.deleteKey(e)):(n.setKey(e,"draw-frame"),this.drawCache[e]=a.serialize()),a.reset(),t in this.drawCache&&a.deserialize(this.drawCache[t]),this.updateGhosting()}},{key:"changeVideoSource",value:function(e){var t=e,a=e;e instanceof File&&(t=URL.createObjectURL(e),a=e.name),this.setState({loading:!0,isNewSession:!1,frame:0,playing:!1,speed:1,min:0,max:1,start:0,end:1,keys:[],videoFilename:a,videoSourceUrl:t}),this.time.current.deleteAllKeys(),this.video.current.load(t),this.draw.current.reset(),this.drawCache={},e instanceof File?this.workers.current.load(e):U.warning("Skipping WorkerPool load for non-local source file")}},{key:"getPreviousDrawFrame",value:function(e){var t,a=Object.keys(this.drawCache);for(t=a.length-1;t>=0&&!(a[t]<e);t--);return!(t<0)&&parseInt(a[t],10)}},{key:"getNextDrawFrame",value:function(e){var t,a=Object.keys(this.drawCache);for(t=0;t<a.length&&!(a[t]>e);t++);return t!==a.length&&parseInt(a[t],10)}},{key:"updateGhosting",value:function(){var e,t=this.video.current.frame,a=this.getPreviousDrawFrame(t);for(e=0;e<this.props.ghostLayers;e++)!1!==a?(this.refs["ghostBack"+e].deserialize(this.drawCache[a]),a=this.getPreviousDrawFrame(a)):this.refs["ghostBack"+e].clear()}},{key:"renderDrawovers",value:function(){for(var e,t=[],a=this.props.ghostLayers-1;a>=0;a--)e=1-(a+1)*this.props.ghostOpacityScale,t.push(r.a.createElement(F,{key:"ghostBack"+a,ref:"ghostBack"+a,readonly:!0,opacity:e,width:this.state.canvas.width,height:this.state.canvas.height}));return t.push(r.a.createElement(F,{key:"main",ref:this.draw,onDraw:this.onDrawDraw,onClear:this.onDrawClear,width:this.state.canvas.width,height:this.state.canvas.height})),t}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"app-canvas",ref:this.canvas},this.state.isNewSession&&r.a.createElement("div",{className:"app-new-session"},r.a.createElement("p",null,"Drop an MP4 or WebM to get started"),r.a.createElement(I,{name:"film"})),r.a.createElement(D,{onFile:this.onDropFile},r.a.createElement(M,null,r.a.createElement(k,{ref:this.video,fps:this.state.fps,onReady:this.onVideoReady,onFrame:this.onFrame,onFrameCache:this.onFrameCache,width:this.state.canvas.width,height:this.state.canvas.height}),this.renderDrawovers()))),r.a.createElement("div",{className:"app-controls"},r.a.createElement("div",{className:"app-controls-row"},r.a.createElement(j,{ref:this.time,fps:this.state.fps,onChange:this.onPickFrame}),r.a.createElement(L,{playing:this.state.playing,speed:this.state.speed,onPause:this.onPlaybackPause,onSkip:this.onPlaybackSkip,onPlay:this.onPlaybackPlay,onSpeed:this.onPlaybackSpeed})),r.a.createElement("div",{className:"app-controls-row"},r.a.createElement(O,{ref:this.range,fps:this.state.fps,min:this.state.min,max:this.state.max,onChange:this.onPickRange})),r.a.createElement(N.a,{ref:this.workers,workers:this.state.totalWebWorkers,onMetadata:this.onWorkerMetadata,onFrames:this.onWorkerFrames})))}}]),t}(r.a.Component);A.defaultProps={ghostLayers:3,ghostOpacityScale:.3};var K=A;i.a.render(r.a.createElement(K,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/drawover",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/drawover","/service-worker.js");o?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):c(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):c(e)})}}()}],[[15,2,1]]]);
//# sourceMappingURL=main.31c85680.chunk.js.map